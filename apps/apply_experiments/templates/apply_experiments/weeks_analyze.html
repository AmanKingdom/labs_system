<!--apply_experiments/weeks_analyze.html-->

{% extends 'apply_experiments/base.html' %}

{% block add_css_to_apply_experiments %}
    <!--固定列表头所需的样式依赖-->
    <link rel="stylesheet" href="/static/css_js/css/fixed-columns/bootstrap-table-fixed-columns.css">
{% endblock %}

{% block apply_experiments_body %}
    <div class="row">
        <div id="toolbar">
            <div class="row">
                <div class="col-sm-4 m-b-xs">
                    <select class="input-sm form-control input-s-sm inline">
                        <option class="selected">计算机科学与技术学院</option>
                        <option>网络安全学院</option>
                    </select>
                </div>
                <div class="col-sm-4 m-b-xs">
                    <select class="input-sm form-control input-s-sm inline">
                        <option>第14周</option>
                        <option class="selected">第15周</option>
                        <option>第16周</option>
                    </select>
                </div>
                <div class="col-sm-4 m-b-xs">
                    <select class="input-sm form-control input-s-sm inline">
                        <option class="selected">--星期--</option>
                        <option>星期一</option>
                        <option>星期二</option>
                        <option>星期三</option>
                        <option>星期四</option>
                        <option>星期五</option>
                        <option>星期六</option>
                        <option>星期七</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered table-hover" id="week_schedule_table"
               data-toggle="table"
               data-classes="table table-hover"
               data-show-columns="true"
               data-striped="true"
               data-show-toggle="true"
               data-search="true"
               data-show-refresh="true"
               data-toolbar="#toolbar"
               data-height="600"
               align="center">
            {#            <thead>#}
            {#            <tr>#}
            {#                <th >星期</th>#}
            {#                <th >节次</th>#}
            {#                <th >7A102</th>#}
            {#            </thead>#}
            <tbody id="schedule_table_body" align="center"></tbody>
        </table>
    </div>
{% endblock %}

{% block add_js_to_apply_experiments %}
    <!--固定列的js-->
    <script src="/static/css_js/js/fixed-columns/bootstrap-table-fixed-columns.js"></script>

    <!--固定列-->
    <script>
        $(function () {
            $('#week_schedule_table').bootstrapTable('destroy').bootstrapTable({
                minimumCountColumns:4,
                fixedColumns:true,
                fixedNumber:2,
            });
        })
    </script>

    <script>
        function initTable() {
            $('#week_schedule_table').bootstrapTable('destroy').bootstrapTable({
                {#sidePagination: "server",#}
                {#url: '{% url "super_manage:get_schedule" %}',#}
                height: 550,
                locale: $('#locale').val(),
                columns: [
                    {
                        field: 'days_of_the_week',
                        title: '星期',
                    }, {
                        field: 'section',
                        title: '节次',
                    }, {
                        field: '8b308',
                        title: '308',
                    }
                ],
                formatNoMatches: function(){
                    return '';
                }
            });
        }

        function load_data() {
            $.ajax({
                cache:true,//保留缓存数据
                type:"POST",
                url:'{% url "super_manage:get_schedule" %}',
                data:JSON.stringify({'school_id': '{{ school.id }}'}),
                dataType:'JSON',
                async:false,
                headers:{'X-CSRFToken':'{{ csrf_token }}'},
                error:function(request){
                    console.log("提交失败", request);
                    alert('提交失败'+request.toString());
                },
                success:function(data){
                    console.log("已提交");
                    console.log('后台返回的json', data.data, '类型', typeof data.data);

                    var tbody = document.getElementsByTagName('tbody');

                    var json = data.data;

                    if(json){
                        for(var i=0; i<json.length; i++){
                            var new_tr = document.createElement('tr');

                            var j = 0;
                            for(let x in json[i]){
                                console.log('key:', x, ' value:', json[i][x]);

                                var new_td = document.createElement('td');
                                new_td.innerHTML = json[i][x];

                                // 如果是第一行的第一列单元格，则要设置跨行，而不是第一行的第一列单元格则不要添加
                                if(i === 0 && j === 0){
                                    new_td.setAttribute("rowspan", '3');
                                    console.log('set rowspan');
                                    new_tr.appendChild(new_td);
                                }else if(i !== 0 && j === 0){
                                    console.log('do nothing');
                                }else{
                                    new_tr.appendChild(new_td);
                                }

                                j = j + 1;
                            }

                            tbody[0].appendChild(new_tr);
                        }
                    }
                }
            });
        }

        $(function() {
            initTable();
            load_data();
            $('#locale').change(initTable);
        })
    </script>
{% endblock %}
